(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/gabriellipson/projects/flux-react-boilerplate/app/App.js":[function(require,module,exports){
'use strict';

var Store = require('./Store.js');
var actions = require('./actions.js');
var marked = require('marked');
var React = require('react');
var ReactDOM = require('react-dom');
var LinkedStateMixin = require('react-addons-linked-state-mixin');
var $ = window.jQuery = require('jquery');
var b = require('bootstrap');

var CommentBox = React.createClass({
  displayName: 'CommentBox',

  loadCommentsFromServer: function loadCommentsFromServer() {
    this.setState({ comments: Store.getMessages() });
  },
  componentWillMount: function componentWillMount() {
    Store.addChangeListener(this.changeState);
  },
  componentWillUnmount: function componentWillUnmount() {
    Store.removeChangeListener(this.changeState);
  },
  changeState: function changeState() {
    this.setState({ comments: Store.getMessages() });
  },
  handleCommentSubmit: function handleCommentSubmit(comment) {
    var comments = this.state.comments;
    // Optimistically set an id on the new comment. It will be replaced by an
    // id generated by the server. In a production application you would likely
    // not use Date.now() for this and would have a more robust system in place.
    var id = comment.id = Date.now();
    var fakeComment = { id: id, text: 'PENDING: ' + comment.text, author: comment.author };
    this.setState({ comments: comments.concat([fakeComment]) });
    // The update evt coming back from the store will override the comment state with what's canonical
    setTimeout(function () {
      actions.addMessage(comment);
    }, 1000);
  },
  getInitialState: function getInitialState() {
    return { comments: [] };
  },
  componentDidMount: function componentDidMount() {
    this.loadCommentsFromServer();
  },
  render: function render() {
    return React.createElement(
      'div',
      { className: 'commentBox' },
      React.createElement(
        'h1',
        null,
        'Comments'
      ),
      React.createElement(CommentList, { comments: this.state.comments }),
      React.createElement(CommentForm, { onCommentSubmit: this.handleCommentSubmit })
    );
  }
});

var CommentList = React.createClass({
  displayName: 'CommentList',

  render: function render() {
    var commentNodes = this.props.comments.map(function (comment) {
      return React.createElement(
        Comment,
        { author: comment.author, key: comment.id },
        comment.text
      );
    });
    return React.createElement(
      'div',
      { className: 'commentList' },
      commentNodes
    );
  }
});

var CommentForm = React.createClass({
  displayName: 'CommentForm',

  getInitialState: function getInitialState() {
    return { author: '', text: '' };
  },
  handleAuthorChange: function handleAuthorChange(e) {
    this.setState({ author: e.target.value });
  },
  handleTextChange: function handleTextChange(e) {
    this.setState({ text: e.target.value });
  },
  handleSubmit: function handleSubmit(e) {
    e.preventDefault();
    var author = this.state.author.trim();
    var text = this.state.text.trim();
    if (!text || !author) {
      return;
    }
    this.props.onCommentSubmit({ author: author, text: text });
    this.setState({ author: '', text: '' });
  },
  render: function render() {
    return React.createElement(
      'form',
      { className: 'commentForm', onSubmit: this.handleSubmit },
      React.createElement('input', {
        type: 'text',
        placeholder: 'Your name',
        value: this.state.author,
        onChange: this.handleAuthorChange
      }),
      React.createElement('textarea', {
        placeholder: 'Say something...',
        value: this.state.text,
        onChange: this.handleTextChange
      }),
      React.createElement('input', { type: 'submit', value: 'Post' })
    );
  }
});

var Comment = React.createClass({
  displayName: 'Comment',

  rawMarkup: function rawMarkup() {
    var rawMarkup = marked(this.props.children.toString(), { sanitize: true });
    return { __html: rawMarkup };
  },
  render: function render() {
    return React.createElement(
      'div',
      { className: 'comment' },
      React.createElement(
        'h2',
        { className: 'commentAuthor' },
        this.props.author
      ),
      React.createElement('span', { dangerouslySetInnerHTML: this.rawMarkup() })
    );
  }
});

var App = React.createClass({
  displayName: 'App',

  render: function render() {
    return React.createElement(CommentBox, null);
  }
});

module.exports = App;

},{"./Store.js":"/Users/gabriellipson/projects/flux-react-boilerplate/app/Store.js","./actions.js":"/Users/gabriellipson/projects/flux-react-boilerplate/app/actions.js","bootstrap":"bootstrap","jquery":"jquery","marked":"marked","react":"react","react-addons-linked-state-mixin":"react-addons-linked-state-mixin","react-dom":"react-dom"}],"/Users/gabriellipson/projects/flux-react-boilerplate/app/Store.js":[function(require,module,exports){
'use strict';

var flux = require('flux-react');
var actions = require('./actions.js');

module.exports = flux.createStore({
  messages: [],
  actions: [actions.addMessage],
  addMessage: function addMessage(message) {
    this.messages.push(message);
    this.emitChange();
  },
  exports: {
    getMessages: function getMessages() {
      return this.messages;
    }
  }
});

},{"./actions.js":"/Users/gabriellipson/projects/flux-react-boilerplate/app/actions.js","flux-react":"flux-react"}],"/Users/gabriellipson/projects/flux-react-boilerplate/app/actions.js":[function(require,module,exports){
'use strict';

var flux = require('flux-react');

module.exports = flux.createActions(['addMessage']);

},{"flux-react":"flux-react"}],"/Users/gabriellipson/projects/flux-react-boilerplate/app/main.js":[function(require,module,exports){
'use strict';

var React = require('react');
var ReactDOM = require('react-dom');
var App = require('./App.js');

ReactDOM.render(React.createElement(App, null), document.getElementById('app'));

},{"./App.js":"/Users/gabriellipson/projects/flux-react-boilerplate/app/App.js","react":"react","react-dom":"react-dom"}]},{},["/Users/gabriellipson/projects/flux-react-boilerplate/app/main.js"])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAvQXBwLmpzIiwiYXBwL1N0b3JlLmpzIiwiYXBwL2FjdGlvbnMuanMiLCJhcHAvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ2xDLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUN0QyxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzdCLElBQUksUUFBUSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUNwQyxJQUFJLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO0FBQ2xFLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQTs7QUFFNUIsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQzs7O0FBQ2pDLHdCQUFzQixFQUFFLGtDQUFXO0FBQ2pDLFFBQUksQ0FBQyxRQUFRLENBQUMsRUFBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztHQUNqRDtBQUNELG9CQUFrQixFQUFFLDhCQUFZO0FBQzlCLFNBQUssQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7R0FDM0M7QUFDRCxzQkFBb0IsRUFBRSxnQ0FBWTtBQUNoQyxTQUFLLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0dBQzlDO0FBQ0QsYUFBVyxFQUFFLHVCQUFZO0FBQ3ZCLFFBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztHQUNsRDtBQUNELHFCQUFtQixFQUFFLDZCQUFTLE9BQU8sRUFBRTtBQUNyQyxRQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVE7Ozs7QUFBQyxBQUluQyxRQUFJLEVBQUUsR0FBRyxPQUFPLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQUNqQyxRQUFJLFdBQVcsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsSUFBSSxnQkFBYyxPQUFPLENBQUMsSUFBSSxBQUFFLEVBQUcsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUN4RixRQUFJLENBQUMsUUFBUSxDQUFDLEVBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFDLENBQUM7O0FBQUEsQUFFekQsY0FBVSxDQUFDLFlBQVU7QUFDbkIsYUFBTyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztLQUM3QixFQUFDLElBQUksQ0FBQyxDQUFBO0dBQ1I7QUFDRCxpQkFBZSxFQUFFLDJCQUFXO0FBQzFCLFdBQU8sRUFBQyxRQUFRLEVBQUUsRUFBRSxFQUFDLENBQUM7R0FDdkI7QUFDRCxtQkFBaUIsRUFBRSw2QkFBVztBQUM1QixRQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztHQUMvQjtBQUNELFFBQU0sRUFBRSxrQkFBVztBQUNqQixXQUNFOztRQUFLLFNBQVMsRUFBQyxZQUFZO01BQ3pCOzs7O09BQWlCO01BQ2pCLG9CQUFDLFdBQVcsSUFBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEFBQUMsR0FBRztNQUM5QyxvQkFBQyxXQUFXLElBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQUFBQyxHQUFHO0tBQ3RELENBQ047R0FDSDtDQUNGLENBQUMsQ0FBQzs7QUFFSCxJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDOzs7QUFDbEMsUUFBTSxFQUFFLGtCQUFXO0FBQ2pCLFFBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFTLE9BQU8sRUFBRTtBQUMzRCxhQUNFO0FBQUMsZUFBTztVQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxBQUFDLEVBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEFBQUM7UUFDOUMsT0FBTyxDQUFDLElBQUk7T0FDTCxDQUNWO0tBQ0gsQ0FBQyxDQUFDO0FBQ0gsV0FDRTs7UUFBSyxTQUFTLEVBQUMsYUFBYTtNQUN6QixZQUFZO0tBQ1QsQ0FDTjtHQUNIO0NBQ0YsQ0FBQyxDQUFDOztBQUVILElBQUksV0FBVyxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUM7OztBQUNsQyxpQkFBZSxFQUFFLDJCQUFXO0FBQzFCLFdBQU8sRUFBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUMsQ0FBQztHQUMvQjtBQUNELG9CQUFrQixFQUFFLDRCQUFTLENBQUMsRUFBRTtBQUM5QixRQUFJLENBQUMsUUFBUSxDQUFDLEVBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQztHQUN6QztBQUNELGtCQUFnQixFQUFFLDBCQUFTLENBQUMsRUFBRTtBQUM1QixRQUFJLENBQUMsUUFBUSxDQUFDLEVBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQztHQUN2QztBQUNELGNBQVksRUFBRSxzQkFBUyxDQUFDLEVBQUU7QUFDeEIsS0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO0FBQ25CLFFBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3RDLFFBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ2xDLFFBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7QUFDcEIsYUFBTztLQUNSO0FBQ0QsUUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO0FBQ3pELFFBQUksQ0FBQyxRQUFRLENBQUMsRUFBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUMsQ0FBQyxDQUFDO0dBQ3ZDO0FBQ0QsUUFBTSxFQUFFLGtCQUFXO0FBQ2pCLFdBQ0U7O1FBQU0sU0FBUyxFQUFDLGFBQWEsRUFBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFlBQVksQUFBQztNQUN4RDtBQUNFLFlBQUksRUFBQyxNQUFNO0FBQ1gsbUJBQVcsRUFBQyxXQUFXO0FBQ3ZCLGFBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQUFBQztBQUN6QixnQkFBUSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQUFBQztRQUNsQztNQUNGO0FBQ0UsbUJBQVcsRUFBQyxrQkFBa0I7QUFDOUIsYUFBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxBQUFDO0FBQ3ZCLGdCQUFRLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixBQUFDO1FBQ2hDO01BQ0YsK0JBQU8sSUFBSSxFQUFDLFFBQVEsRUFBQyxLQUFLLEVBQUMsTUFBTSxHQUFHO0tBQy9CLENBQ1A7R0FDSDtDQUNGLENBQUMsQ0FBQzs7QUFFSCxJQUFJLE9BQU8sR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDOzs7QUFDNUIsV0FBUyxFQUFFLHFCQUFXO0FBQ3BCLFFBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO0FBQ3pFLFdBQU8sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLENBQUM7R0FDOUI7QUFDRCxRQUFNLEVBQUUsa0JBQVc7QUFDakIsV0FDRTs7UUFBSyxTQUFTLEVBQUMsU0FBUztNQUN0Qjs7VUFBSSxTQUFTLEVBQUMsZUFBZTtRQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07T0FDZjtNQUNMLDhCQUFNLHVCQUF1QixFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsQUFBQyxHQUFHO0tBQy9DLENBQ047R0FDSDtDQUNKLENBQUMsQ0FBQzs7QUFFSCxJQUFJLEdBQUcsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDOzs7QUFDMUIsUUFBTSxFQUFFLGtCQUFXO0FBQ2pCLFdBQU8sb0JBQUMsVUFBVSxPQUFHLENBQUE7R0FDdEI7Q0FDRixDQUFDLENBQUE7O0FBRUYsTUFBTSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7Ozs7O0FDcElyQixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDakMsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDOztBQUV0QyxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7QUFDaEMsVUFBUSxFQUFFLEVBQUU7QUFDWixTQUFPLEVBQUUsQ0FDUCxPQUFPLENBQUMsVUFBVSxDQUNuQjtBQUNELFlBQVUsRUFBRSxvQkFBVSxPQUFPLEVBQUU7QUFDN0IsUUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDNUIsUUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0dBQ25CO0FBQ0QsU0FBTyxFQUFFO0FBQ1AsZUFBVyxFQUFFLHVCQUFZO0FBQ3ZCLGFBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztLQUN0QjtHQUNGO0NBQ0YsQ0FBQyxDQUFDOzs7OztBQ2pCSCxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7O0FBRWpDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUNsQyxZQUFZLENBQ2IsQ0FBQyxDQUFDOzs7OztBQ0pILElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM3QixJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDcEMsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDOztBQUU5QixRQUFRLENBQUMsTUFBTSxDQUNiLG9CQUFDLEdBQUcsT0FBRyxFQUNQLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQy9CLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIFN0b3JlID0gcmVxdWlyZSgnLi9TdG9yZS5qcycpO1xudmFyIGFjdGlvbnMgPSByZXF1aXJlKCcuL2FjdGlvbnMuanMnKTtcbnZhciBtYXJrZWQgPSByZXF1aXJlKCdtYXJrZWQnKTtcbnZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG52YXIgUmVhY3RET00gPSByZXF1aXJlKCdyZWFjdC1kb20nKTtcbnZhciBMaW5rZWRTdGF0ZU1peGluID0gcmVxdWlyZSgncmVhY3QtYWRkb25zLWxpbmtlZC1zdGF0ZS1taXhpbicpO1xudmFyICQgPSB3aW5kb3cualF1ZXJ5ID0gcmVxdWlyZSgnanF1ZXJ5Jyk7XG52YXIgYiA9IHJlcXVpcmUoJ2Jvb3RzdHJhcCcpXG5cbnZhciBDb21tZW50Qm94ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICBsb2FkQ29tbWVudHNGcm9tU2VydmVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtjb21tZW50czogU3RvcmUuZ2V0TWVzc2FnZXMoKSB9KTtcbiAgfSxcbiAgY29tcG9uZW50V2lsbE1vdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgU3RvcmUuYWRkQ2hhbmdlTGlzdGVuZXIodGhpcy5jaGFuZ2VTdGF0ZSk7XG4gIH0sXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50OiBmdW5jdGlvbiAoKSB7XG4gICAgU3RvcmUucmVtb3ZlQ2hhbmdlTGlzdGVuZXIodGhpcy5jaGFuZ2VTdGF0ZSk7XG4gIH0sXG4gIGNoYW5nZVN0YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGNvbW1lbnRzOiBTdG9yZS5nZXRNZXNzYWdlcygpIH0pO1xuICB9LFxuICBoYW5kbGVDb21tZW50U3VibWl0OiBmdW5jdGlvbihjb21tZW50KSB7XG4gICAgdmFyIGNvbW1lbnRzID0gdGhpcy5zdGF0ZS5jb21tZW50cztcbiAgICAvLyBPcHRpbWlzdGljYWxseSBzZXQgYW4gaWQgb24gdGhlIG5ldyBjb21tZW50LiBJdCB3aWxsIGJlIHJlcGxhY2VkIGJ5IGFuXG4gICAgLy8gaWQgZ2VuZXJhdGVkIGJ5IHRoZSBzZXJ2ZXIuIEluIGEgcHJvZHVjdGlvbiBhcHBsaWNhdGlvbiB5b3Ugd291bGQgbGlrZWx5XG4gICAgLy8gbm90IHVzZSBEYXRlLm5vdygpIGZvciB0aGlzIGFuZCB3b3VsZCBoYXZlIGEgbW9yZSByb2J1c3Qgc3lzdGVtIGluIHBsYWNlLlxuICAgIHZhciBpZCA9IGNvbW1lbnQuaWQgPSBEYXRlLm5vdygpO1xuICAgIHZhciBmYWtlQ29tbWVudCA9IHsgaWQ6IGlkLCB0ZXh0OiBgUEVORElORzogJHtjb21tZW50LnRleHR9YCAsIGF1dGhvcjogY29tbWVudC5hdXRob3IgfTtcbiAgICB0aGlzLnNldFN0YXRlKHtjb21tZW50czogY29tbWVudHMuY29uY2F0KFtmYWtlQ29tbWVudF0pfSlcbiAgICAvLyBUaGUgdXBkYXRlIGV2dCBjb21pbmcgYmFjayBmcm9tIHRoZSBzdG9yZSB3aWxsIG92ZXJyaWRlIHRoZSBjb21tZW50IHN0YXRlIHdpdGggd2hhdCdzIGNhbm9uaWNhbFxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIGFjdGlvbnMuYWRkTWVzc2FnZShjb21tZW50KTsgICAgXG4gICAgfSwxMDAwKVxuICB9LFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7Y29tbWVudHM6IFtdfTtcbiAgfSxcbiAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubG9hZENvbW1lbnRzRnJvbVNlcnZlcigpO1xuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImNvbW1lbnRCb3hcIj5cbiAgICAgICAgPGgxPkNvbW1lbnRzPC9oMT5cbiAgICAgICAgPENvbW1lbnRMaXN0IGNvbW1lbnRzPXt0aGlzLnN0YXRlLmNvbW1lbnRzfSAvPlxuICAgICAgICA8Q29tbWVudEZvcm0gb25Db21tZW50U3VibWl0PXt0aGlzLmhhbmRsZUNvbW1lbnRTdWJtaXR9IC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59KTtcblxudmFyIENvbW1lbnRMaXN0ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb21tZW50Tm9kZXMgPSB0aGlzLnByb3BzLmNvbW1lbnRzLm1hcChmdW5jdGlvbihjb21tZW50KSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Q29tbWVudCBhdXRob3I9e2NvbW1lbnQuYXV0aG9yfSBrZXk9e2NvbW1lbnQuaWR9PlxuICAgICAgICAgIHtjb21tZW50LnRleHR9XG4gICAgICAgIDwvQ29tbWVudD5cbiAgICAgICk7XG4gICAgfSk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY29tbWVudExpc3RcIj5cbiAgICAgICAge2NvbW1lbnROb2Rlc31cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn0pO1xuXG52YXIgQ29tbWVudEZvcm0gPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHthdXRob3I6ICcnLCB0ZXh0OiAnJ307XG4gIH0sXG4gIGhhbmRsZUF1dGhvckNoYW5nZTogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoe2F1dGhvcjogZS50YXJnZXQudmFsdWV9KTtcbiAgfSxcbiAgaGFuZGxlVGV4dENoYW5nZTogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoe3RleHQ6IGUudGFyZ2V0LnZhbHVlfSk7XG4gIH0sXG4gIGhhbmRsZVN1Ym1pdDogZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB2YXIgYXV0aG9yID0gdGhpcy5zdGF0ZS5hdXRob3IudHJpbSgpO1xuICAgIHZhciB0ZXh0ID0gdGhpcy5zdGF0ZS50ZXh0LnRyaW0oKTtcbiAgICBpZiAoIXRleHQgfHwgIWF1dGhvcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uQ29tbWVudFN1Ym1pdCh7YXV0aG9yOiBhdXRob3IsIHRleHQ6IHRleHR9KTtcbiAgICB0aGlzLnNldFN0YXRlKHthdXRob3I6ICcnLCB0ZXh0OiAnJ30pO1xuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8Zm9ybSBjbGFzc05hbWU9XCJjb21tZW50Rm9ybVwiIG9uU3VibWl0PXt0aGlzLmhhbmRsZVN1Ym1pdH0+XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIllvdXIgbmFtZVwiXG4gICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUuYXV0aG9yfVxuICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUF1dGhvckNoYW5nZX1cbiAgICAgICAgLz5cbiAgICAgICAgPHRleHRhcmVhXG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJTYXkgc29tZXRoaW5nLi4uXCJcbiAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS50ZXh0fVxuICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZVRleHRDaGFuZ2V9XG4gICAgICAgIC8+XG4gICAgICAgIDxpbnB1dCB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCJQb3N0XCIgLz5cbiAgICAgIDwvZm9ybT5cbiAgICApO1xuICB9XG59KTtcblxudmFyIENvbW1lbnQgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgcmF3TWFya3VwOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByYXdNYXJrdXAgPSBtYXJrZWQodGhpcy5wcm9wcy5jaGlsZHJlbi50b1N0cmluZygpLCB7c2FuaXRpemU6IHRydWV9KTtcbiAgICAgIHJldHVybiB7IF9faHRtbDogcmF3TWFya3VwIH07XG4gICAgfSxcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb21tZW50XCI+XG4gICAgICAgICAgPGgyIGNsYXNzTmFtZT1cImNvbW1lbnRBdXRob3JcIj5cbiAgICAgICAgICAgIHt0aGlzLnByb3BzLmF1dGhvcn1cbiAgICAgICAgICA8L2gyPlxuICAgICAgICAgIDxzcGFuIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXt0aGlzLnJhd01hcmt1cCgpfSAvPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxufSk7XG5cbnZhciBBcHAgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIDxDb21tZW50Qm94IC8+XG4gIH1cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gQXBwOyIsInZhciBmbHV4ID0gcmVxdWlyZSgnZmx1eC1yZWFjdCcpO1xudmFyIGFjdGlvbnMgPSByZXF1aXJlKCcuL2FjdGlvbnMuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmbHV4LmNyZWF0ZVN0b3JlKHtcbiAgbWVzc2FnZXM6IFtdLFxuICBhY3Rpb25zOiBbXG4gICAgYWN0aW9ucy5hZGRNZXNzYWdlXG4gIF0sXG4gIGFkZE1lc3NhZ2U6IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgdGhpcy5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICAgIHRoaXMuZW1pdENoYW5nZSgpO1xuICB9LFxuICBleHBvcnRzOiB7XG4gICAgZ2V0TWVzc2FnZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1lc3NhZ2VzO1xuICAgIH1cbiAgfVxufSk7XG4iLCJ2YXIgZmx1eCA9IHJlcXVpcmUoJ2ZsdXgtcmVhY3QnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmbHV4LmNyZWF0ZUFjdGlvbnMoW1xuICAnYWRkTWVzc2FnZSdcbl0pOyIsInZhciBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG52YXIgUmVhY3RET00gPSByZXF1aXJlKCdyZWFjdC1kb20nKTtcbnZhciBBcHAgPSByZXF1aXJlKCcuL0FwcC5qcycpO1xuXG5SZWFjdERPTS5yZW5kZXIoXG4gIDxBcHAgLz4sXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAnKVxuKTsiXX0=
